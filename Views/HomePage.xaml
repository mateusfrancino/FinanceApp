<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:helpers="clr-namespace:FinanceApp.Helpers"
             xmlns:viewmodels="clr-namespace:FinanceApp.ViewModels"
             xmlns:skia="clr-namespace:SkiaSharp.Views.Maui.Controls;assembly=SkiaSharp.Views.Maui.Controls"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:DataType="viewmodels:HomePageViewModel"
             x:Class="FinanceApp.Views.HomePage"
             BackgroundColor="#E6E7E8">

    <ContentPage.Resources>
        <Style x:Key="Field" TargetType="Grid">
            <Setter Property="RowDefinitions" Value="Auto,Auto,Auto"/>
            <Setter Property="RowSpacing" Value="2"/>
            <Setter Property="Margin" Value="5"/>
        </Style>

        <Style x:Key="Caption" TargetType="Label">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="TextColor" Value="#555"/>
        </Style>
        <Style x:Key="Help" TargetType="Label">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="HorizontalTextAlignment" Value="Center"/>
        </Style>
    </ContentPage.Resources>



    <Grid>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="30" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <Grid Grid.Row="1">
                <Border Background="#F5F5F5" Stroke="White" StrokeThickness="1" Margin="70,25,70,25" Padding="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="20"/>
                    </Border.StrokeShape>

                    <!-- Grade principal -->
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="70*"/>
                            <RowDefinition Height="30*"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                        </Grid.ColumnDefinitions>

                        <Border Grid.Row="0" Grid.RowSpan="2" 
                                Background="Transparent" Stroke="Transparent" Padding="0" Margin="10">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="20"/>
                            </Border.StrokeShape>

                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="10*"/>
                                    <RowDefinition Height="85*"/>
                                    <RowDefinition Height="5*"/>
                                </Grid.RowDefinitions>

                                <!-- Header -->
                                <Border Grid.Row="0" Background="Transparent" Stroke="Transparent" Padding="0" Margin="10,10,10,0">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <Image Grid.Column="0" Source="btg_logo_completo.png"
                                               HeightRequest="52" WidthRequest="142"
                                               Margin="0,1,0,0" Aspect="AspectFit"
                                               HorizontalOptions="Start" VerticalOptions="Start"/>
                                    </Grid>
                                </Border>

                                <!--Conteudo-->
                                <Grid Grid.Row="1" Padding="0" RowDefinitions="Auto,*,Auto" ColumnDefinitions="*">

                                    <FlexLayout Grid.Row="0"
                                                Direction="Row"
                                                Wrap="Wrap"
                                                JustifyContent="Start"
                                                AlignItems="Center"
                                                Margin="0,0,0,10">

                                        <!-- Preço inicial -->
                                        <Grid Style="{StaticResource Field}" FlexLayout.Basis="160">
                                            <Label Grid.Row="0" Text="Preço inicial" Style="{StaticResource Caption}"/>
                                            <Entry Grid.Row="1" Text="{Binding InitialPrice}" Keyboard="Numeric" VerticalOptions="Center"/>
                                            <Label Grid.Row="2" Text="" />
                                        </Grid>

                                        <!-- Volatilidade -->
                                        <Grid Style="{StaticResource Field}" FlexLayout.Basis="200">
                                            <Label Grid.Row="0" Text="Volatilidade (σ)" Style="{StaticResource Caption}"/>
                                            <Slider Grid.Row="1" Minimum="0.01" Maximum="0.6" Value="{Binding Vol}" VerticalOptions="Center"/>
                                            <Label  Grid.Row="2" Text="{Binding Vol, StringFormat='σ={0:F2}'}" Style="{StaticResource Help}"/>
                                        </Grid>

                                        <!-- Média -->
                                        <Grid Style="{StaticResource Field}" FlexLayout.Basis="200">
                                            <Label Grid.Row="0" Text="Média (μ)" Style="{StaticResource Caption}"/>
                                            <Slider Grid.Row="1" Minimum="-0.05" Maximum="0.10" Value="{Binding Mean}" VerticalOptions="Center"/>
                                            <Label  Grid.Row="2" Text="{Binding Mean, StringFormat='μ={0:F3}'}" Style="{StaticResource Help}"/>
                                        </Grid>

                                        <!-- Dias (valor ao lado do Stepper) -->
                                        <Grid Style="{StaticResource Field}" FlexLayout.Basis="130">
                                            <Label Grid.Row="0" Text="Dias" Style="{StaticResource Caption}"/>
                                            <HorizontalStackLayout Grid.Row="1" Spacing="8" VerticalOptions="Center">
                                                <Stepper Minimum="10" Maximum="2000" Increment="10" Value="{Binding NumDays}" />
                                                <Label Text="{Binding NumDays}" VerticalTextAlignment="Center"/>
                                            </HorizontalStackLayout>
                                            <Label Grid.Row="2" Text="" />
                                        </Grid>

                                        <!-- Simulações (valor ao lado do Stepper) -->
                                        <Grid Style="{StaticResource Field}" FlexLayout.Basis="100">
                                            <Label Grid.Row="0" Text="Simulações" Style="{StaticResource Caption}"/>
                                            <HorizontalStackLayout Grid.Row="1" Spacing="8" VerticalOptions="Center">
                                                <Stepper Minimum="1" Maximum="8" Increment="1" Value="{Binding Simulations}" />
                                                <Label Text="{Binding Simulations}" VerticalTextAlignment="Center"/>
                                            </HorizontalStackLayout>
                                            <Label Grid.Row="2" Text="" />
                                        </Grid>

                                        <!-- Espessura -->
                                        <Grid Style="{StaticResource Field}" FlexLayout.Basis="200">
                                            <Label Grid.Row="0" Text="Espessura" Style="{StaticResource Caption}"/>
                                            <Slider Grid.Row="1" Minimum="1" Maximum="5" Value="{Binding StrokeWidth}" VerticalOptions="Center"/>
                                            <Label Grid.Row="2" Text="{Binding StrokeWidth, StringFormat='{0:0}'}" Style="{StaticResource Help}"/>
                                        </Grid>

                                        <!-- Normalizar (checkbox + texto lado a lado) -->
                                        <Grid Style="{StaticResource Field}" FlexLayout.Basis="220">
                                            <Label Grid.Row="0" Text=" " />
                                            <HorizontalStackLayout Grid.Row="1" Spacing="4" VerticalOptions="Center">
                                                <CheckBox IsChecked="{Binding Normalize}" />
                                                <Label Text="Normalizar (base=1.0)" VerticalTextAlignment="Center"/>
                                            </HorizontalStackLayout>
                                            <Label Grid.Row="2" Text=" " />
                                        </Grid>

                                        <!-- Cor (swatches + "cor unica") -->
                                        <Grid Style="{StaticResource Field}" FlexLayout.Basis="200">
                                            <Label Grid.Row="0" Text="Cor" Style="{StaticResource Caption}"/>

                                            <FlexLayout Grid.Row="1" Direction="Row" Wrap="NoWrap" AlignItems="Center">
                                                <!-- Azul -->
                                                <Border Stroke="#00000000" StrokeThickness="1" Margin="2" Padding="0">
                                                    <Border.Triggers>
                                                        <DataTrigger TargetType="Border" Binding="{Binding SelectedColorHex}" Value="#4682B4">
                                                            <Setter Property="Stroke" Value="#5B4EEB"/>
                                                            <Setter Property="StrokeThickness" Value="2"/>
                                                        </DataTrigger>
                                                    </Border.Triggers>
                                                    <Grid>
                                                        <BoxView WidthRequest="22" HeightRequest="22" Color="#4682B4"/>
                                                        <Label Text="✓" FontSize="10" HorizontalOptions="Center" VerticalOptions="Center" IsVisible="False">
                                                            <Label.Triggers>
                                                                <DataTrigger TargetType="Label" Binding="{Binding SelectedColorHex}" Value="#4682B4">
                                                                    <Setter Property="IsVisible" Value="True"/>
                                                                </DataTrigger>
                                                            </Label.Triggers>
                                                        </Label>
                                                    </Grid>
                                                    <Border.GestureRecognizers>
                                                        <TapGestureRecognizer Command="{Binding SetColorCommand}" CommandParameter="#4682B4"/>
                                                    </Border.GestureRecognizers>
                                                </Border>

                                                <!-- Vermelho -->
                                                <Border Stroke="#00000000" StrokeThickness="1" Margin="2" Padding="0">
                                                    <Border.Triggers>
                                                        <DataTrigger TargetType="Border" Binding="{Binding SelectedColorHex}" Value="#C45850">
                                                            <Setter Property="Stroke" Value="#5B4EEB"/>
                                                            <Setter Property="StrokeThickness" Value="2"/>
                                                        </DataTrigger>
                                                    </Border.Triggers>
                                                    <Grid>
                                                        <BoxView WidthRequest="22" HeightRequest="22" Color="#C45850"/>
                                                        <Label Text="✓" FontSize="10" HorizontalOptions="Center" VerticalOptions="Center" IsVisible="False">
                                                            <Label.Triggers>
                                                                <DataTrigger TargetType="Label" Binding="{Binding SelectedColorHex}" Value="#C45850">
                                                                    <Setter Property="IsVisible" Value="True"/>
                                                                </DataTrigger>
                                                            </Label.Triggers>
                                                        </Label>
                                                    </Grid>
                                                    <Border.GestureRecognizers>
                                                        <TapGestureRecognizer Command="{Binding SetColorCommand}" CommandParameter="#C45850"/>
                                                    </Border.GestureRecognizers>
                                                </Border>

                                                <!-- Verde -->
                                                <Border Stroke="#00000000" StrokeThickness="1" Margin="2" Padding="0">
                                                    <Border.Triggers>
                                                        <DataTrigger TargetType="Border" Binding="{Binding SelectedColorHex}" Value="#2E8B57">
                                                            <Setter Property="Stroke" Value="#5B4EEB"/>
                                                            <Setter Property="StrokeThickness" Value="2"/>
                                                        </DataTrigger>
                                                    </Border.Triggers>
                                                    <Grid>
                                                        <BoxView WidthRequest="22" HeightRequest="22" Color="#2E8B57"/>
                                                        <Label Text="✓" FontSize="10" HorizontalOptions="Center" VerticalOptions="Center" IsVisible="False">
                                                            <Label.Triggers>
                                                                <DataTrigger TargetType="Label" Binding="{Binding SelectedColorHex}" Value="#2E8B57">
                                                                    <Setter Property="IsVisible" Value="True"/>
                                                                </DataTrigger>
                                                            </Label.Triggers>
                                                        </Label>
                                                    </Grid>
                                                    <Border.GestureRecognizers>
                                                        <TapGestureRecognizer Command="{Binding SetColorCommand}" CommandParameter="#2E8B57"/>
                                                    </Border.GestureRecognizers>
                                                </Border>

                                                <!-- Roxo -->
                                                <Border Stroke="#00000000" StrokeThickness="1" Margin="2" Padding="0">
                                                    <Border.Triggers>
                                                        <DataTrigger TargetType="Border" Binding="{Binding SelectedColorHex}" Value="#6A5ACD">
                                                            <Setter Property="Stroke" Value="#5B4EEB"/>
                                                            <Setter Property="StrokeThickness" Value="2"/>
                                                        </DataTrigger>
                                                    </Border.Triggers>
                                                    <Grid>
                                                        <BoxView WidthRequest="22" HeightRequest="22" Color="#6A5ACD"/>
                                                        <Label Text="✓" FontSize="10" HorizontalOptions="Center" VerticalOptions="Center" IsVisible="False">
                                                            <Label.Triggers>
                                                                <DataTrigger TargetType="Label" Binding="{Binding SelectedColorHex}" Value="#6A5ACD">
                                                                    <Setter Property="IsVisible" Value="True"/>
                                                                </DataTrigger>
                                                            </Label.Triggers>
                                                        </Label>
                                                    </Grid>
                                                    <Border.GestureRecognizers>
                                                        <TapGestureRecognizer Command="{Binding SetColorCommand}" CommandParameter="#6A5ACD"/>
                                                    </Border.GestureRecognizers>
                                                </Border>

                                                <!-- Dourado -->
                                                <Border Stroke="#00000000" StrokeThickness="1" Margin="2" Padding="0">
                                                    <Border.Triggers>
                                                        <DataTrigger TargetType="Border" Binding="{Binding SelectedColorHex}" Value="#DAA520">
                                                            <Setter Property="Stroke" Value="#5B4EEB"/>
                                                            <Setter Property="StrokeThickness" Value="2"/>
                                                        </DataTrigger>
                                                    </Border.Triggers>
                                                    <Grid>
                                                        <BoxView WidthRequest="22" HeightRequest="22" Color="#DAA520"/>
                                                        <Label Text="✓" FontSize="10" HorizontalOptions="Center" VerticalOptions="Center" IsVisible="False">
                                                            <Label.Triggers>
                                                                <DataTrigger TargetType="Label" Binding="{Binding SelectedColorHex}" Value="#DAA520">
                                                                    <Setter Property="IsVisible" Value="True"/>
                                                                </DataTrigger>
                                                            </Label.Triggers>
                                                        </Label>
                                                    </Grid>
                                                    <Border.GestureRecognizers>
                                                        <TapGestureRecognizer Command="{Binding SetColorCommand}" CommandParameter="#DAA520"/>
                                                    </Border.GestureRecognizers>
                                                </Border>
                                            </FlexLayout>

                                            <HorizontalStackLayout Grid.Row="2" Spacing="4" VerticalOptions="Center">
                                                <CheckBox IsChecked="{Binding ApplyColorToAll}" />
                                                <Label Text="Cor única p/ todas" VerticalTextAlignment="Center"/>
                                            </HorizontalStackLayout>
                                        </Grid>

                                        <!-- Estilo -->
                                        <Grid Style="{StaticResource Field}" FlexLayout.Basis="110">
                                            <Label Grid.Row="0" Text="Estilo" Style="{StaticResource Caption}"/>
                                            <Picker Grid.Row="1" ItemsSource="{Binding LineStyles}" SelectedItem="{Binding SelectedStyle}" VerticalOptions="Center"/>
                                            <Label Grid.Row="2" Text="" />
                                        </Grid>

                                        <!-- Botão -->
                                        <Grid Style="{StaticResource Field}" FlexLayout.Basis="180">
                                            <Label Grid.Row="0" Text="" />
                                            <Button Grid.Row="1" Text="Simular" Command="{Binding SimulateCommand}" HeightRequest="42" />
                                            <Label Grid.Row="2" Text="" />
                                        </Grid>

                                    </FlexLayout>

                                    <!-- Gráfico -->
                                    <skia:SKCanvasView Grid.Row="1" x:Name="Canvas" PaintSurface="OnCanvasPaintSurface" />

                                    <HorizontalStackLayout Grid.Row="2" Spacing="12" Margin="4,15,0,0">
                                        <Label Text="Legenda:" FontAttributes="Bold"/>
                                        <Label Text="Séries coloridas por paleta automática ou pela cor escolhida" FontSize="12" Margin="0,2,0,0"/>
                                    </HorizontalStackLayout>
                                </Grid>
                              
                                <!-- Img decorativo -->
                                <Border Grid.Row="2" Background="Transparent" Stroke="Transparent">
                                    <Image Source="rodape_paginas_invertido.png"
                                           Aspect="Fill" Margin="0,20,0,0"
                                           HeightRequest="2" VerticalOptions="Start"/>
                                </Border>
                                
                            </Grid>
                        </Border>
                    </Grid>
                </Border>
            </Grid>

            <!-- Rodapé -->
            <BoxView Grid.Row="2" BackgroundColor="#001861" HeightRequest="30"/>
            
        </Grid>
    </Grid>
</ContentPage>
